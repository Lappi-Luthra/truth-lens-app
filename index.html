<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Truth Lens Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.39.0/build/stlite.css" />
  </head>
  <body>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.39.0/build/stlite.js"></script>
    <script>
      stlite.mount({
        requirements: ["pillow", "requests"], // Removed the heavy AI libraries
        entrypoint: "app.py",
        files: {
          "app.py": `
import streamlit as st
import requests
from PIL import Image
import io
import base64

st.set_page_config(page_title="Truth Lens")
st.title("üõ°Ô∏è TRUTH LENS PRO")

# Use a lighter approach for keys
with st.sidebar:
    st.header("API Configuration")
    g_key = st.text_input("Gemini API Key", type="password")

file = st.file_uploader("Upload Evidence", type=['jpg', 'png', 'jpeg'])

if file:
    img = Image.open(file)
    st.image(img, use_container_width=True)
    
    if st.button("üöÄ RUN FORENSIC SCAN"):
        if not g_key:
            st.error("Please enter your Gemini API Key!")
        else:
            with st.spinner("Analyzing Pixels via Gemini Flash..."):
                try:
                    # Convert image to Base64 for the API
                    buffered = io.BytesIO()
                    img.save(buffered, format="JPEG")
                    img_str = base64.b64encode(buffered.getvalue()).decode()

                    # Direct API Call (No heavy SDK needed)
                    url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key={g_key}"
                    payload = {
                        "contents": [{
                            "parts": [
                                {"text": "Analyze this Indian UPI/Payment screenshot for signs of forgery, font mismatch, or digital tampering. Provide a risk score."},
                                {"inline_data": {"mime_type": "image/jpeg", "data": img_str}}
                            ]
                        }]
                    }
                    
                    response = requests.post(url, json=payload)
                    result = response.json()
                    
                    # Display Result
                    ans = result['candidates'][0]['content']['parts'][0]['text']
                    st.subheader("Forensic Verdict:")
                    st.write(ans)
                    st.success("Analysis Complete")
                except Exception as e:
                    st.error("Error: Ensure your API Key is correct and has Gemini 1.5 access.")
`
        }
      }, document.getElementById("root"));
    </script>
  </body>
</html>
