<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Truth Lens Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.39.0/build/stlite.css" />
  </head>
  <body>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.39.0/build/stlite.js"></script>
    <script>
      stlite.mount({
        requirements: ["pillow", "requests"],
        entrypoint: "app.py",
        files: {
          "app.py": `
import streamlit as st
import requests
from PIL import Image
import io
import base64

# 1. CSS HACK TO HIDE "MADE WITH STREAMLIT" AND FOOTER
hide_style = """
    <style>
    #MainMenu {visibility: hidden;}
    footer {visibility: hidden;}
    header {visibility: hidden;}
    .stApp { bottom: 0px; }
    </style>
"""
st.markdown(hide_style, unsafe_allow_html=True)

st.set_page_config(page_title="Truth Lens", page_icon="üõ°Ô∏è")
st.markdown("<h1 style='text-align: center; color: #00f2fe;'>üõ°Ô∏è TRUTH LENS PRO</h1>", unsafe_allow_html=True)
st.markdown("<p style='text-align: center; color: #8892b0;'>Digital Forensic Audit Tool</p>", unsafe_allow_html=True)

with st.sidebar:
    st.header("üîë Authentication")
    g_key = st.text_input("Enter Gemini Passkey", type="password")
    st.caption("v2.1.0 | No-Data-Retention Policy")

file = st.file_uploader("üì∏ Upload Screenshot for Audit", type=['jpg', 'png', 'jpeg'])

if file:
    img = Image.open(file)
    st.image(img, use_container_width=True)
    
    if st.button("üöÄ EXECUTE FORENSIC SCAN"):
        if not g_key:
            st.error("Access Denied: Please enter Passkey in sidebar.")
        else:
            with st.status("Analyzing Pixel Gradients...", expanded=True) as status:
                try:
                    buffered = io.BytesIO()
                    img.save(buffered, format="JPEG")
                    img_str = base64.b64encode(buffered.getvalue()).decode()

                    url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key={g_key}"
                    payload = {
                        "contents": [{
                            "parts": [
                                {"text": "Act as a forensic expert. Examine this Indian UPI receipt. Check for: 1. Font inconsistency in amount. 2. Ghosting around Transaction ID. 3. Visual artifacts in the bank logo. Provide a clear Verdict: SAFE or SUSPICIOUS."},
                                {"inline_data": {"mime_type": "image/jpeg", "data": img_str}}
                            ]
                        }]
                    }
                    
                    response = requests.post(url, json=payload)
                    result = response.json()
                    ans = result['candidates'][0]['content']['parts'][0]['text']
                    
                    status.update(label="Scan Complete!", state="complete")
                    
                    st.subheader("üèÅ Forensic Verdict:")
                    st.markdown(f"```\\n{ans}\\n```")
                except Exception as e:
                    st.error("Audit Failed. Check connection or Passkey.")
`
        }
      }, document.getElementById("root"));
    </script>
  </body>
</html>
