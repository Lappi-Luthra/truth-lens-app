<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Truth Lens Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.39.0/build/stlite.css" />
  </head>
  <body>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.39.0/build/stlite.js"></script>
    <script>
      stlite.mount({
        requirements: ["pillow", "requests"],
        entrypoint: "app.py",
        files: {
          "app.py": `
import streamlit as st
import requests
from PIL import Image
import io
import base64

# CSS HACK TO HIDE STREAMLIT BRANDING
st.markdown("""
    <style>
    #MainMenu {visibility: hidden;}
    footer {visibility: hidden;}
    header {visibility: hidden;}
    .stDeployButton {display:none;}
    </style>
""", unsafe_allow_html=True)

st.set_page_config(page_title="Truth Lens", page_icon="ğŸ›¡ï¸")
st.markdown("<h1 style='text-align: center; color: #00f2fe;'>ğŸ›¡ï¸ TRUTH LENS PRO</h1>", unsafe_allow_html=True)

with st.sidebar:
    st.header("ğŸ”‘ Authentication")
    g_key = st.text_input("Enter Gemini Passkey", type="password")

file = st.file_uploader("ğŸ“¸ Upload Screenshot", type=['jpg', 'png', 'jpeg'])

if file:
    img = Image.open(file)
    st.image(img, use_container_width=True)
    
    if st.button("ğŸš€ EXECUTE FORENSIC SCAN"):
        if not g_key:
            st.error("Please enter Passkey in sidebar.")
        else:
            with st.status("Analyzing Pixels...", expanded=True) as status:
                try:
                    buffered = io.BytesIO()
                    img.save(buffered, format="JPEG")
                    img_str = base64.b64encode(buffered.getvalue()).decode()

                    url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=" + g_key
                    payload = {
                        "contents": [{
                            "parts": [
                                {"text": "Act as a forensic expert. Examine this Indian UPI receipt. Check for: 1. Font inconsistency. 2. Ghosting around text. 3. Visual artifacts. Verdict: SAFE or SUSPICIOUS."},
                                {"inline_data": {"mime_type": "image/jpeg", "data": img_str}}
                            ]
                        }]
                    }
                    
                    response = requests.post(url, json=payload)
                    result = response.json()
                    ans = result['candidates'][0]['content']['parts'][0]['text']
                    
                    status.update(label="Scan Complete!", state="complete")
                    
                    st.subheader("ğŸ Forensic Verdict:")
                    st.info(ans)
                except Exception as e:
                    st.error("Audit Failed. Check connection or Passkey.")
`
        }
      }, document.getElementById("root"));
    </script>
  </body>
</html>
